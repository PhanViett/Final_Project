"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@react-pdf-viewer/core");function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n,r=t(require("react")),o=function(){return r.createElement(e.Icon,{size:16},r.createElement("path",{d:"M6.427,8.245A.5.5,0,0,1,6.862,7.5H17.138a.5.5,0,0,1,.435.749l-5.139,9a.5.5,0,0,1-.868,0Z"}))},a=function(){return r.createElement(e.Icon,{size:16},r.createElement("path",{d:"M9.248,17.572a.5.5,0,0,1-.748-.434V6.862a.5.5,0,0,1,.748-.434l8.992,5.138a.5.5,0,0,1,0,.868Z"}))},i=function(e){var t=e.bookmark,n=e.depth,i=e.doc,s=e.index,l=e.isBookmarkExpanded,u=e.numberOfSiblings,m=e.renderBookmarkItem,k=e.store,d=e.onJumpToDest,f=r.useMemo((function(){return function(e){var t=e.count,n=e.items;if(t>=0)return!1;var r=n.length;if(0===r)return!1;for(var o=n.concat([]);o.length>0;){var a=o.shift(),i=a.items;a.count&&i&&a.count>0&&i.length>0&&(r+=i.length,o=o.concat(i))}return Math.abs(t)===r}(t)}),[t]),p=l?l({bookmark:t,doc:i,depth:n,index:s}):!f,b=r.useState(p),v=b[0],E=b[1],g=t.items&&t.items.length>0,_=function(){return E((function(e){return!e}))},h=function(){g&&t.dest&&d(t.dest)},x=function(){!g&&t.dest&&d(t.dest)},B=function(e,t){return r.createElement("div",{className:"rpv-bookmark__item",style:{paddingLeft:"".concat(1.25*n,"rem")},onClick:e},t)},D=function(e,t){return g?r.createElement("span",{className:"rpv-bookmark__toggle","data-testid":"bookmark__toggle-".concat(n,"-").concat(s),onClick:_},v?e:t):r.createElement("span",{className:"rpv-bookmark__toggle"})},I=function(e){return t.url?r.createElement("a",{className:"rpv-bookmark__title",href:t.url,rel:"noopener noreferrer nofollow",target:t.newWindow?"_blank":""},t.title):r.createElement("div",{className:"rpv-bookmark__title","aria-label":t.title,onClick:e},t.title)};return r.createElement("li",{"aria-expanded":v?"true":"false","aria-label":t.title,"aria-level":n+1,"aria-posinset":s+1,"aria-setsize":u,role:"treeitem",tabIndex:-1},m?m({bookmark:t,depth:n,hasSubItems:g,index:s,isExpanded:v,defaultRenderItem:B,defaultRenderTitle:I,defaultRenderToggle:D,onClickItem:x,onClickTitle:h,onToggleSubItems:_}):B(x,r.createElement(r.Fragment,null,D(r.createElement(o,null),r.createElement(a,null)),I(h))),g&&v&&r.createElement(c,{bookmarks:t.items,depth:n+1,doc:i,isBookmarkExpanded:l,isRoot:!1,renderBookmarkItem:m,store:k,onJumpToDest:d}))},c=function(e){var t=e.bookmarks,n=e.depth,o=void 0===n?0:n,a=e.doc,c=e.isBookmarkExpanded,s=e.isRoot,l=e.renderBookmarkItem,u=e.store,m=e.onJumpToDest;return r.createElement("ul",{className:"rpv-bookmark__list",role:s?"tree":"group",tabIndex:-1},t.map((function(e,n){return r.createElement(i,{bookmark:e,depth:o,doc:a,index:n,isBookmarkExpanded:c,key:n,numberOfSiblings:t.length,renderBookmarkItem:l,store:u,onJumpToDest:m})})))};!function(e){e[e.Collapse=0]="Collapse",e[e.Expand=1]="Expand"}(n||(n={}));var s=function(t){var o=t.bookmarks,a=t.doc,i=t.isBookmarkExpanded,s=t.renderBookmarkItem,l=t.store,u=t.onJumpToDest,m=r.useRef(),k=r.useState(l.get("linkAnnotations")||{}),d=k[0],f=k[1],p=function(e,t){var n=e.dest;n&&"string"==typeof n&&t[n]&&(t[n].querySelectorAll('a[data-annotation-link-dest="'.concat(n,'"]')).forEach((function(t){t.setAttribute("aria-label",e.title)})),e.items&&e.items.length&&e.items.forEach((function(e){return p(e,t)})))},b=function(e){return f(e)},v=function(e){var t=m.current;if(t&&e.target instanceof HTMLElement&&t.contains(e.target))switch(e.key){case"ArrowDown":e.preventDefault(),g((function(e,t){return e.indexOf(t)+1}));break;case"ArrowLeft":e.preventDefault(),_(n.Collapse);break;case"ArrowRight":e.preventDefault(),_(n.Expand);break;case"ArrowUp":e.preventDefault,g((function(e,t){return e.indexOf(t)-1}));break;case"End":e.preventDefault(),g((function(e,t){return e.length-1}));break;case" ":case"Enter":case"Space":e.preventDefault(),E();break;case"Home":e.preventDefault(),g((function(e,t){return 0}))}},E=function(){var e=document.activeElement.closest(".rpv-bookmark__item").querySelector(".rpv-bookmark__title");e&&e.click()},g=function(e){var t=m.current,n=[].slice.call(t.getElementsByClassName("rpv-bookmark__item"));if(0!==n.length){var r=document.activeElement,o=n[Math.min(n.length-1,Math.max(0,e(n,r)))];r.setAttribute("tabindex","-1"),o.setAttribute("tabindex","0"),o.focus()}},_=function(e){var t=m.current;if(0!==[].slice.call(t.getElementsByClassName("rpv-bookmark__item")).length){var r=document.activeElement.closest(".rpv-bookmark__item"),o=e===n.Collapse?"true":"false";if(r&&r.parentElement.getAttribute("aria-expanded")===o){var a=r.querySelector(".rpv-bookmark__toggle");a&&a.click()}}};return r.useEffect((function(){return document.addEventListener("keydown",v),l.subscribe("linkAnnotations",b),function(){document.removeEventListener("keydown",v),l.unsubscribe("linkAnnotations",b)}}),[]),r.useEffect((function(){o.forEach((function(e){return p(e,d)}))}),[d]),r.useEffect((function(){var e=m.current;if(e){var t=[].slice.call(e.getElementsByClassName("rpv-bookmark__item"));t.length>0&&(t[0].focus(),t[0].setAttribute("tabindex","0"))}}),[]),r.createElement("div",{ref:m},r.createElement(c,{bookmarks:o,depth:0,doc:a,isBookmarkExpanded:i,isRoot:!0,renderBookmarkItem:s,store:l,onJumpToDest:function(t){e.getDestination(a,t).then((function(e){var t=e.pageIndex,n=e.bottomOffset,r=e.leftOffset,o=e.scaleTo;u(t,n,r,o)}))}}))},l=function(t){var n=t.doc,o=t.isBookmarkExpanded,a=t.renderBookmarkItem,i=t.store,c=t.onJumpToDest,l=r.useContext(e.LocalizationContext).l10n,u=r.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,m=r.useState({isLoaded:!1,items:[]}),k=m[0],d=m[1];return r.useEffect((function(){d({isLoaded:!1,items:[]}),n.getOutline().then((function(e){d({isLoaded:!0,items:e||[]})}))}),[n]),k.isLoaded?0===k.items.length?r.createElement("div",{"data-testid":"bookmark__empty",className:e.classNames({"rpv-bookmark__empty":!0,"rpv-bookmark__empty--rtl":u})},l&&l.bookmark?l.bookmark.noBookmark:"There is no bookmark"):r.createElement("div",{"data-testid":"bookmark__container",className:e.classNames({"rpv-bookmark__container":!0,"rpv-bookmark__container--rtl":u})},r.createElement(s,{bookmarks:k.items,doc:n,isBookmarkExpanded:o,renderBookmarkItem:a,store:i,onJumpToDest:c})):r.createElement("div",{className:"rpv-bookmark__loader"},r.createElement(e.Spinner,null))},u=function(t){var n=t.isBookmarkExpanded,o=t.renderBookmarkItem,a=t.store,i=r.useState(a.get("doc")),c=i[0],s=i[1],u=function(e){s(e)};return r.useEffect((function(){return a.subscribe("doc",u),function(){a.unsubscribe("doc",u)}}),[]),c?r.createElement(l,{doc:c,isBookmarkExpanded:n,renderBookmarkItem:o,store:a,onJumpToDest:function(e,t,n,r){var o=a.get("jumpToDestination");o&&o(e,t,n,r)}}):r.createElement("div",{className:"rpv-bookmark__loader"},r.createElement(e.Spinner,null))};exports.DownArrowIcon=o,exports.RightArrowIcon=a,exports.bookmarkPlugin=function(){var t=r.useMemo((function(){return e.createStore({linkAnnotations:{}})}),[]);return{install:function(e){t.update("jumpToDestination",e.jumpToDestination)},onDocumentLoad:function(e){t.update("doc",e.doc)},Bookmarks:function(e){return r.createElement(u,{isBookmarkExpanded:null==e?void 0:e.isBookmarkExpanded,renderBookmarkItem:null==e?void 0:e.renderBookmarkItem,store:t})},onAnnotationLayerRender:function(e){if(e.annotations.length){var n=e.annotations.filter((function(e){return"Link"===e.subtype}));if(n.length){var r=t.get("linkAnnotations")||{};n.forEach((function(t){return r[t.dest]=e.container})),t.update("linkAnnotations",r)}}}}};
