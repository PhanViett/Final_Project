{"ast":null,"code":"var _jsxFileName = \"D:\\\\FHDC\\\\CCHND-V2\\\\src\\\\app\\\\modules\\\\apps\\\\auth\\\\core\\\\Auth.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport { useState, useEffect, createContext, useContext, useRef } from \"react\";\nimport * as authHelper from \"./AuthHelpers\";\nimport { getUserByToken } from \"./_requests\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst initAuthContextPropsState = {\n  auth: authHelper.getAuth(),\n  saveAuth: () => {},\n  currentUser: undefined,\n  roleUser: undefined,\n  setCurrentUser: () => {},\n  setRoleUser: () => {},\n  logout: () => {}\n};\nconst AuthContext = /*#__PURE__*/createContext(initAuthContextPropsState);\n\nconst useAuth = () => {\n  _s();\n\n  return useContext(AuthContext);\n};\n\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nconst AuthProvider = _ref => {\n  _s2();\n\n  let {\n    children\n  } = _ref;\n  const [auth, setAuth] = useState(authHelper.getAuth());\n  const [currentUser, setCurrentUser] = useState();\n  const [roleUser, setRoleUser] = useState();\n\n  const saveAuth = auth => {\n    setAuth(auth);\n\n    if (auth) {\n      authHelper.setAuth(auth);\n    } else {\n      authHelper.removeAuth();\n    }\n  };\n\n  const logout = () => {\n    saveAuth(undefined);\n    setCurrentUser(undefined);\n    setRoleUser(undefined);\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      auth,\n      saveAuth,\n      currentUser,\n      roleUser,\n      setCurrentUser,\n      setRoleUser,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(AuthProvider, \"0Wwmo3tAa9Yjr4RGeVWDo2/o3Wo=\");\n\n_c = AuthProvider;\n\nconst AuthInit = _ref2 => {\n  _s3();\n\n  let {\n    children\n  } = _ref2;\n  const {\n    auth,\n    logout,\n    setCurrentUser,\n    setRoleUser\n  } = useAuth();\n  const didRequest = useRef(false); // We should request user by authToken (IN OUR EXAMPLE IT'S API_TOKEN) before rendering the application\n\n  useEffect(() => {\n    const requestUser = async apiToken => {\n      try {\n        if (!didRequest.current) {\n          const {\n            data\n          } = await getUserByToken(apiToken);\n\n          if (data) {\n            setCurrentUser(data);\n\n            if (data !== null && data !== void 0 && data.assigned_role) {\n              setRoleUser(data === null || data === void 0 ? void 0 : data.assigned_role);\n            }\n          }\n        }\n      } catch (error) {\n        console.error(error);\n\n        if (!didRequest.current) {\n          logout();\n        }\n      }\n\n      return () => didRequest.current = true;\n    };\n\n    if (auth && auth.access_token) {\n      requestUser(auth.access_token);\n    } else {\n      logout();\n    } // eslint-disable-next-line\n\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: children\n  }, void 0, false);\n};\n\n_s3(AuthInit, \"UKnOA8huidjP2P15J+euCilVIog=\", false, function () {\n  return [useAuth];\n});\n\n_c2 = AuthInit;\nexport { AuthProvider, AuthInit, useAuth };\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"AuthProvider\");\n$RefreshReg$(_c2, \"AuthInit\");","map":{"version":3,"names":["useState","useEffect","createContext","useContext","useRef","authHelper","getUserByToken","initAuthContextPropsState","auth","getAuth","saveAuth","currentUser","undefined","roleUser","setCurrentUser","setRoleUser","logout","AuthContext","useAuth","AuthProvider","children","setAuth","removeAuth","AuthInit","didRequest","requestUser","apiToken","current","data","assigned_role","error","console","access_token"],"sources":["D:/FHDC/CCHND-V2/src/app/modules/apps/auth/core/Auth.tsx"],"sourcesContent":["import {\r\n  FC,\r\n  useState,\r\n  useEffect,\r\n  createContext,\r\n  useContext,\r\n  useRef,\r\n  Dispatch,\r\n  SetStateAction,\r\n} from \"react\";\r\nimport { AuthModel, UserModel } from \"./_models\";\r\nimport * as authHelper from \"./AuthHelpers\";\r\nimport { getUserByToken } from \"./_requests\";\r\n\r\ntype AuthContextProps = {\r\n  auth: AuthModel | undefined;\r\n  saveAuth: (auth: AuthModel | undefined) => void;\r\n  currentUser: UserModel | undefined;\r\n  roleUser: any | undefined;\r\n  setCurrentUser: Dispatch<SetStateAction<UserModel | undefined>>;\r\n  setRoleUser: Dispatch<SetStateAction<any | undefined>>;\r\n  logout: () => void;\r\n};\r\n\r\nconst initAuthContextPropsState = {\r\n  auth: authHelper.getAuth(),\r\n  saveAuth: () => {},\r\n  currentUser: undefined,\r\n  roleUser: undefined,\r\n  setCurrentUser: () => {},\r\n  setRoleUser: () => {},\r\n  logout: () => {},\r\n};\r\n\r\nconst AuthContext = createContext<AuthContextProps>(initAuthContextPropsState);\r\n\r\nconst useAuth = () => {\r\n  return useContext(AuthContext);\r\n};\r\n\r\nconst AuthProvider: FC = ({ children }) => {\r\n  const [auth, setAuth] = useState<AuthModel | undefined>(authHelper.getAuth());\r\n  const [currentUser, setCurrentUser] = useState<UserModel | undefined>();\r\n  const [roleUser, setRoleUser] = useState<any | undefined>();\r\n\r\n  const saveAuth = (auth: AuthModel | undefined) => {\r\n    setAuth(auth);\r\n    if (auth) {\r\n      authHelper.setAuth(auth);\r\n    } else {\r\n      authHelper.removeAuth();\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    saveAuth(undefined);\r\n    setCurrentUser(undefined);\r\n    setRoleUser(undefined);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        auth,\r\n        saveAuth,\r\n        currentUser,\r\n        roleUser,\r\n        setCurrentUser,\r\n        setRoleUser,\r\n        logout,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nconst AuthInit: FC = ({ children }) => {\r\n  const { auth, logout, setCurrentUser, setRoleUser } = useAuth();\r\n  const didRequest = useRef(false);\r\n  // We should request user by authToken (IN OUR EXAMPLE IT'S API_TOKEN) before rendering the application\r\n  useEffect(() => {\r\n    const requestUser = async (apiToken: string) => {\r\n      try {\r\n        if (!didRequest.current) {\r\n          const { data } = await getUserByToken(apiToken);\r\n          if (data) {\r\n            setCurrentUser(data);\r\n            if (data?.assigned_role) {\r\n              setRoleUser(data?.assigned_role);\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        if (!didRequest.current) {\r\n          logout();\r\n        }\r\n      }\r\n      return () => (didRequest.current = true);\r\n    };\r\n\r\n    if (auth && auth.access_token) {\r\n      requestUser(auth.access_token);\r\n    } else {\r\n      logout();\r\n    }\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  return <>{children}</>;\r\n};\r\n\r\nexport { AuthProvider, AuthInit, useAuth };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}