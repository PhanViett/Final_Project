{"ast":null,"code":"import _regeneratorRuntime from\"D:/FHDC/CCHND-V2/Frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/FHDC/CCHND-V2/Frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/FHDC/CCHND-V2/Frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,createContext,useContext,useRef}from\"react\";import*as authHelper from\"./AuthHelpers\";import{getUserByToken}from\"./_requests\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var initAuthContextPropsState={auth:authHelper.getAuth(),saveAuth:function saveAuth(){},currentUser:undefined,roleUser:undefined,setCurrentUser:function setCurrentUser(){},setRoleUser:function setRoleUser(){},logout:function logout(){}};var AuthContext=/*#__PURE__*/createContext(initAuthContextPropsState);var useAuth=function useAuth(){return useContext(AuthContext);};var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(authHelper.getAuth()),_useState2=_slicedToArray(_useState,2),auth=_useState2[0],setAuth=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),roleUser=_useState6[0],setRoleUser=_useState6[1];var saveAuth=function saveAuth(auth){setAuth(auth);if(auth){authHelper.setAuth(auth);}else{authHelper.removeAuth();}};var logout=function logout(){saveAuth(undefined);setCurrentUser(undefined);setRoleUser(undefined);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{auth:auth,saveAuth:saveAuth,currentUser:currentUser,roleUser:roleUser,setCurrentUser:setCurrentUser,setRoleUser:setRoleUser,logout:logout},children:children});};var AuthInit=function AuthInit(_ref2){var children=_ref2.children;var _useAuth=useAuth(),auth=_useAuth.auth,logout=_useAuth.logout,setCurrentUser=_useAuth.setCurrentUser,setRoleUser=_useAuth.setRoleUser;var didRequest=useRef(false);// We should request user by authToken (IN OUR EXAMPLE IT'S API_TOKEN) before rendering the application\nuseEffect(function(){var requestUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(apiToken){var _yield$getUserByToken,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(didRequest.current){_context.next=7;break;}_context.next=4;return getUserByToken(apiToken);case 4:_yield$getUserByToken=_context.sent;data=_yield$getUserByToken.data;if(data){setCurrentUser(data);if(data!==null&&data!==void 0&&data.assigned_role){setRoleUser(data===null||data===void 0?void 0:data.assigned_role);}}case 7:_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.error(_context.t0);if(!didRequest.current){logout();}case 13:return _context.abrupt(\"return\",function(){return didRequest.current=true;});case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function requestUser(_x){return _ref3.apply(this,arguments);};}();if(auth&&auth.access_token){requestUser(auth.access_token);}else{logout();}// eslint-disable-next-line\n},[]);return/*#__PURE__*/_jsx(_Fragment,{children:children});};export{AuthProvider,AuthInit,useAuth};","map":{"version":3,"names":["useState","useEffect","createContext","useContext","useRef","authHelper","getUserByToken","initAuthContextPropsState","auth","getAuth","saveAuth","currentUser","undefined","roleUser","setCurrentUser","setRoleUser","logout","AuthContext","useAuth","AuthProvider","children","setAuth","removeAuth","AuthInit","didRequest","requestUser","apiToken","current","data","assigned_role","console","error","access_token"],"sources":["D:/FHDC/CCHND-V2/Frontend/src/app/modules/apps/auth/core/Auth.tsx"],"sourcesContent":["import {\r\n  FC,\r\n  useState,\r\n  useEffect,\r\n  createContext,\r\n  useContext,\r\n  useRef,\r\n  Dispatch,\r\n  SetStateAction,\r\n} from \"react\";\r\nimport { AuthModel, UserModel } from \"./_models\";\r\nimport * as authHelper from \"./AuthHelpers\";\r\nimport { getUserByToken } from \"./_requests\";\r\n\r\ntype AuthContextProps = {\r\n  auth: AuthModel | undefined;\r\n  saveAuth: (auth: AuthModel | undefined) => void;\r\n  currentUser: UserModel | undefined;\r\n  roleUser: any | undefined;\r\n  setCurrentUser: Dispatch<SetStateAction<UserModel | undefined>>;\r\n  setRoleUser: Dispatch<SetStateAction<any | undefined>>;\r\n  logout: () => void;\r\n};\r\n\r\nconst initAuthContextPropsState = {\r\n  auth: authHelper.getAuth(),\r\n  saveAuth: () => {},\r\n  currentUser: undefined,\r\n  roleUser: undefined,\r\n  setCurrentUser: () => {},\r\n  setRoleUser: () => {},\r\n  logout: () => {},\r\n};\r\n\r\nconst AuthContext = createContext<AuthContextProps>(initAuthContextPropsState);\r\n\r\nconst useAuth = () => {\r\n  return useContext(AuthContext);\r\n};\r\n\r\nconst AuthProvider: FC = ({ children }) => {\r\n  const [auth, setAuth] = useState<AuthModel | undefined>(authHelper.getAuth());\r\n  const [currentUser, setCurrentUser] = useState<UserModel | undefined>();\r\n  const [roleUser, setRoleUser] = useState<any | undefined>();\r\n\r\n  const saveAuth = (auth: AuthModel | undefined) => {\r\n    setAuth(auth);\r\n    if (auth) {\r\n      authHelper.setAuth(auth);\r\n    } else {\r\n      authHelper.removeAuth();\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    saveAuth(undefined);\r\n    setCurrentUser(undefined);\r\n    setRoleUser(undefined);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        auth,\r\n        saveAuth,\r\n        currentUser,\r\n        roleUser,\r\n        setCurrentUser,\r\n        setRoleUser,\r\n        logout,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nconst AuthInit: FC = ({ children }) => {\r\n  const { auth, logout, setCurrentUser, setRoleUser } = useAuth();\r\n  const didRequest = useRef(false);\r\n  // We should request user by authToken (IN OUR EXAMPLE IT'S API_TOKEN) before rendering the application\r\n  useEffect(() => {\r\n    const requestUser = async (apiToken: string) => {\r\n      try {\r\n        if (!didRequest.current) {\r\n          const { data } = await getUserByToken(apiToken);\r\n          if (data) {\r\n            setCurrentUser(data);\r\n            if (data?.assigned_role) {\r\n              setRoleUser(data?.assigned_role);\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        if (!didRequest.current) {\r\n          logout();\r\n        }\r\n      }\r\n      return () => (didRequest.current = true);\r\n    };\r\n\r\n    if (auth && auth.access_token) {\r\n      requestUser(auth.access_token);\r\n    } else {\r\n      logout();\r\n    }\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  return <>{children}</>;\r\n};\r\n\r\nexport { AuthProvider, AuthInit, useAuth };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}